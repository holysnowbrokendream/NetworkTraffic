# 🌐 NetworkTraffic 内网部署指南

## 🎯 部署概述

本指南将帮助您将 NetworkTraffic 网络流量分析系统部署到内网环境，使同一局域网内的其他设备能够通过网络访问您的应用。

### 🌐 部署架构

```
内网设备 A ──┐
内网设备 B ──┼── 路由器/交换机 ── 部署服务器
内网设备 C ──┘                    │
                                 ├── 前端 (23456端口)
                                 ├── 后端 (8000端口)
                                 └── 数据库 (3307端口)
```

### 📊 访问地址

- **前端应用**: `http://[服务器IP]:23456`
- **后端API**: `http://[服务器IP]:8000`
- **管理界面**: `http://[服务器IP]:8000/admin/`

## 🌐 网络配置

```bash
# 进入HTTP目录
cd HTTP

# 运行网络配置脚本
configure_network_access.bat
```

**脚本功能**:
- 自动检测本机IP地址
- 更新Django设置文件
- 更新环境变量配置
- 显示网络访问信息

## 🔒 防火墙配置

### Windows 系统

#### 使用配置脚本

```bash
# 进入HTTP目录
cd HTTP

# 运行网络配置脚本
configure_firewall.bat
```

**脚本功能**:
- 脚本会自动配置以下端口：
- 8000: 后端API服务
- 23456: 前端Web服务
- 3307: 数据库服务

---

## 🧪 访问测试

### 1. 本地测试

在部署服务器上测试：

```bash
# 测试前端
curl http://localhost:23456

# 测试后端
curl http://localhost:8000/api/health/

# 测试管理界面
curl http://localhost:8000/admin/
```

### 2. 内网测试

从内网其他设备测试：

```bash
# 替换 [服务器IP] 为实际IP地址
curl http://[服务器IP]:23456
curl http://[服务器IP]:8000/api/health/
```

### 3. 浏览器测试

在浏览器中访问：

- **前端应用**: `http://[服务器IP]:23456`
- **后端API**: `http://[服务器IP]:8000`
- **管理界面**: `http://[服务器IP]:8000/admin/`

### 4. 测试账户

- **管理员**: `admin` / `123456`
- **测试用户**: `yang` / `123456`

---

## 🔍 故障排除

### 常见问题及解决方案

#### 1. 无法访问前端页面

**症状**: 浏览器显示 "无法访问此网站"

**解决方案**:
```bash
# 检查前端容器状态
docker-compose -f docker-compose.production.yml ps frontend

# 查看前端日志
docker-compose -f docker-compose.production.yml logs frontend

# 检查端口是否被占用
netstat -ano | findstr :23456
```

#### 2. 前端无法连接后端API

**症状**: 前端页面显示 "连接错误" 或 "API不可用"

**解决方案**:
```bash
# 检查后端容器状态
docker-compose -f docker-compose.production.yml ps backend

# 查看后端日志
docker-compose -f docker-compose.production.yml logs backend

# 测试后端API
curl http://[服务器IP]:8000/api/health/
```

#### 3. 数据库连接失败

**症状**: 后端日志显示 "MySQL connection failed"

**解决方案**:
```bash
# 检查MySQL容器状态
docker-compose -f docker-compose.production.yml ps mysql

# 查看MySQL日志
docker-compose -f docker-compose.production.yml logs mysql

# 重启MySQL服务
docker-compose -f docker-compose.production.yml restart mysql
```

#### 4. 防火墙阻止访问

**症状**: 内网设备无法访问服务器

**解决方案**:
```bash
# Windows系统 - 检查防火墙规则
netsh advfirewall firewall show rule name="NetworkTraffic*"

# 重新配置防火墙
configure_firewall.bat
```

#### 5. 端口被占用

**症状**: 启动服务时显示 "port is already allocated"

**解决方案**:
```bash
# 查看端口占用
netstat -ano | findstr :8000
netstat -ano | findstr :23456

# 停止占用端口的进程
taskkill /PID <进程ID> /F

# 重新启动服务
start-services.bat
```

### 日志分析

#### 查看所有服务日志
```bash
docker-compose -f docker-compose.production.yml logs -f
```

#### 查看特定服务日志
```bash
# 前端日志
docker-compose -f docker-compose.production.yml logs -f frontend

# 后端日志
docker-compose -f docker-compose.production.yml logs -f backend

# 数据库日志
docker-compose -f docker-compose.production.yml logs -f mysql
```

#### 查看容器状态
```bash
docker-compose -f docker-compose.production.yml ps
```

---
