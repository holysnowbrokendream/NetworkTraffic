# 🌐 NetworkTraffic 内网部署指南

## 🎯 部署概述

本指南将帮助您将 NetworkTraffic 网络流量分析系统部署到内网环境，使同一局域网内的其他设备能够通过网络访问您的应用。

### 🌐 部署架构

```
内网设备 A ──┐
内网设备 B ──┼── 路由器/交换机 ── 部署服务器
内网设备 C ──┘                    │
                                 ├── 前端 (23456端口)
                                 ├── 后端 (8000端口)
                                 └── 数据库 (3307端口)
```

### 📊 访问地址

- **前端应用**: `http://[服务器IP]:23456`
- **后端API**: `http://[服务器IP]:8000`
- **管理界面**: `http://[服务器IP]:8000/admin/`

---

## 🌐 网络配置

### 1. 获取服务器IP地址

#### Windows 系统
```cmd
ipconfig
```
查找 "IPv4 地址" 字段，通常格式为 `192.168.x.x` 或 `10.x.x.x`

#### Linux/macOS 系统
```bash
ifconfig
# 或
ip addr show
```

### 2. 检查网络连通性

确保内网设备能够访问服务器：

```bash
# 从其他设备ping服务器
ping [服务器IP地址]

# 检查端口是否开放
# Windows:
telnet [服务器IP地址] 8000
telnet [服务器IP地址] 23456
# Linux:
nc -zv [服务器IP地址] 8000
nc -zv [服务器IP地址] 23456
```

---

## 🔒 防火墙配置

### Windows 系统

#### 使用配置脚本

```bash
# 进入HTTP目录
cd HTTP

# 运行网络配置脚本
configure_firewall.bat
```

**脚本功能**:
- 脚本会自动配置以下端口：
- 8000: 后端API服务
- 23456: 前端Web服务
- 3307: 数据库服务

### Linux 系统

#### 使用配置脚本（推荐）

```bash
# 进入HTTP目录
cd HTTP

# 以root权限运行防火墙配置脚本
sudo ./configure_firewall.sh
```

**脚本功能**:
- 自动检测 Linux 发行版 (CentOS/RHEL 或 Ubuntu)
- 配置 firewalld (CentOS/RHEL) 或 ufw (Ubuntu)
- 开放必要端口 (8000, 23456, 3307)
- 配置 iptables 规则

#### 手动配置

- **CentOS/RHEL (firewalld):**
  ```bash
  sudo firewall-cmd --permanent --add-port=8000/tcp
  sudo firewall-cmd --permanent --add-port=23456/tcp
  sudo firewall-cmd --permanent --add-port=3307/tcp
  sudo firewall-cmd --reload
  ```
- **Ubuntu (ufw):**
  ```bash
  sudo ufw allow 8000/tcp
  sudo ufw allow 23456/tcp
  sudo ufw allow 3307/tcp
  sudo ufw enable
  ```
- **通用（iptables）:**
  ```bash
  sudo iptables -A INPUT -p tcp --dport 8000 -j ACCEPT
  sudo iptables -A INPUT -p tcp --dport 23456 -j ACCEPT
  sudo iptables -A INPUT -p tcp --dport 3307 -j ACCEPT
  ```

---

## 🚀 部署步骤

### 步骤 1: 配置网络访问

#### Windows
```bash
cd HTTP
configure_network_access.bat
```
#### Linux
```bash
cd HTTP
./configure_network_access.sh
```

**脚本功能**:
- 自动检测本机IP地址
- 更新Django设置文件
- 更新环境变量配置
- 显示网络访问信息

## 🧪 访问测试

### 1. 本地测试

在部署服务器上测试：

```bash
# 测试前端
curl http://localhost:23456

# 测试后端
curl http://localhost:8000/api/health/

# 测试管理界面
curl http://localhost:8000/admin/
```

### 2. 内网测试

从内网其他设备测试：

```bash
# 替换 [服务器IP] 为实际IP地址
curl http://[服务器IP]:23456
curl http://[服务器IP]:8000/api/health/
```

### 3. 浏览器测试

在浏览器中访问：

- **前端应用**: `http://[服务器IP]:23456`
- **后端API**: `http://[服务器IP]:8000`
- **管理界面**: `http://[服务器IP]:8000/admin/`

### 4. 测试账户

- **管理员**: `admin` / `123456`
- **测试用户**: `yang` / `123456`

---

## 🔍 故障排除

### 常见问题及解决方案

#### 1. 无法访问前端页面

**症状**: 浏览器显示 "无法访问此网站"

**解决方案**:
```bash
# 检查前端容器状态
# Windows/Linux 通用
docker-compose -f docker-compose.production.yml ps frontend

# 查看前端日志
docker-compose -f docker-compose.production.yml logs frontend

# 检查端口是否被占用
# Windows:
netstat -ano | findstr :23456
# Linux:
sudo netstat -tulpn | grep :23456
```

#### 2. 前端无法连接后端API

**症状**: 前端页面显示 "连接错误" 或 "API不可用"

**解决方案**:
```bash
# 检查后端容器状态
docker-compose -f docker-compose.production.yml ps backend

# 查看后端日志
docker-compose -f docker-compose.production.yml logs backend

# 测试后端API
curl http://[服务器IP]:8000/api/health/
```

#### 3. 数据库连接失败

**症状**: 后端日志显示 "MySQL connection failed"

**解决方案**:
```bash
# 检查MySQL容器状态
docker-compose -f docker-compose.production.yml ps mysql

# 查看MySQL日志
docker-compose -f docker-compose.production.yml logs mysql

# 重启MySQL服务
docker-compose -f docker-compose.production.yml restart mysql
```

#### 4. 防火墙阻止访问

**症状**: 内网设备无法访问服务器

**解决方案**:
```bash
# Windows系统 - 检查防火墙规则
netsh advfirewall firewall show rule name="NetworkTraffic*"

# Linux系统 - 检查防火墙规则
sudo firewall-cmd --list-ports   # CentOS/RHEL
sudo ufw status                  # Ubuntu
sudo iptables -L                 # 通用

# 重新配置防火墙
# Windows:
configure_firewall.bat
# Linux:
sudo ./configure_firewall.sh
```

#### 5. 端口被占用

**症状**: 启动服务时显示 "port is already allocated"

**解决方案**:
```bash
# 查看端口占用
# Windows:
netstat -ano | findstr :8000
netstat -ano | findstr :23456
# Linux:
sudo netstat -tulpn | grep :8000
sudo netstat -tulpn | grep :23456

# 停止占用端口的进程
# Windows:
taskkill /PID <进程ID> /F
# Linux:
sudo kill -9 <进程ID>

# 重新启动服务
# Windows:
start-services.bat
# Linux:
./start-services.sh
```

### 日志分析

#### 查看所有服务日志
```bash
docker-compose -f docker-compose.production.yml logs -f
```

#### 查看特定服务日志
```bash
# 前端日志
docker-compose -f docker-compose.production.yml logs -f frontend

# 后端日志
docker-compose -f docker-compose.production.yml logs -f backend

# 数据库日志
docker-compose -f docker-compose.production.yml logs -f mysql
```

#### 查看容器状态
```bash
docker-compose -f docker-compose.production.yml ps
```

---


